
# MCP 定时任务工具设计思路

## 1. 基础模型设计

首先我们需要定义一个清晰的任务模型，包括：

- **任务标识**：唯一ID，便于检索和管理
- **任务名称**：用户友好的描述 
- **调度规则**：cron表达式或固定间隔
- **任务类型**：关联到哪种清理操作（如应用缓存清理、系统临时文件清理等）
- **任务参数**：执行具体清理操作所需的参数
- **任务状态**：启用/禁用
- **执行历史**：最后执行时间、执行结果等

## 2. 持久化策略

基于Croner库的序列化能力，我们可以：

- 使用JSON文件存储所有任务配置（例如`~/.trash-cleaner/schedules.json`）
- 启动时读取此文件并重新调度所有任务
- 任务变更时更新文件
- 定期备份配置文件，防止意外损坏

## 3. MCP工具接口设计

可以设计以下几个主要工具接口：

### 3.1 任务创建工具
```
[Schedule] createTask
- 参数：任务名称、cron表达式、工具名称、工具参数等
- 功能：创建并启动一个新任务
```

### 3.2 任务管理工具
```
[Schedule] listTasks 
- 参数：筛选条件（可选）
- 功能：列出所有任务及其状态

[Schedule] getTaskDetails
- 参数：任务ID
- 功能：获取特定任务的详细信息

[Schedule] updateTask
- 参数：任务ID、更新的参数（cron表达式、工具参数等）
- 功能：更新已有任务

[Schedule] enableTask/disableTask
- 参数：任务ID
- 功能：启用或禁用任务

[Schedule] deleteTask
- 参数：任务ID
- 功能：删除任务

[Schedule] runTaskNow
- 参数：任务ID
- 功能：立即执行指定任务
```

### 3.3 任务历史查询工具
```
[Schedule] getTaskHistory
- 参数：任务ID、时间范围
- 功能：查询任务的历史执行记录
```

## 4. 与现有工具集成

定时任务工具需要能够：

- 动态调用已注册的其他工具（如清理工具）
- 传递正确的参数
- 捕获执行结果

这可能需要一个任务执行器，它能根据任务定义找到并调用相应的工具函数。

## 5. 错误处理策略

- 任务执行失败时记录详细日志
- 支持配置失败后的重试策略
- 关键任务失败通知机制

## 6. 实现步骤规划

1. 创建任务模型和持久化层
2. 实现任务调度核心逻辑（基于Croner）
3. 开发MCP工具接口
4. 实现与已有清理工具的集成
5. 添加错误处理和日志记录
6. 提供任务历史记录功能

通过这样系统性地设计，我们可以为MCP服务提供强大、灵活且可靠的定时任务能力，支持用户自动化执行各种清理操作。
